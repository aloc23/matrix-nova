<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Matrix Nova - Business Analytics Platform</title>
  <link rel="stylesheet" href="modern-dark-theme.css">
  <link rel="stylesheet" href="icons.css">
  <link rel="stylesheet" href="multi-select-dropdown.css">
  <!-- Feather Icons for modern SVG icons -->
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> <!-- ADD THIS LINE -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="config.js" defer></script>
  <script src="calculations.js" defer></script>
  <script src="templates.js" defer></script>
  <script src="state-manager.js" defer></script>
  <script src="multi-select-dropdown.js" defer></script>
  <script src="project-selector-integration.js" defer></script>
  <script src="dynamic-ui.js" defer></script>
  <script src="script.js" defer></script>
  <script>
    // Initialize Feather icons when page loads
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof feather !== 'undefined') {
        feather.replace();
      }
    });
  </script>
</head>
<body>
  <main>
    <nav class="tabs" role="tablist">
      <button type="button" data-tab="business-analytics" class="active">Business Analytics</button>
      <button type="button" data-tab="investment-model">Investment Model</button>
      <button type="button" data-tab="staffing-resourcing">Staffing & Resources</button>
      <button type="button" data-tab="execution-scheduling">Execution & Scheduling</button>
      <button type="button" data-tab="project-files">Project Files</button>
      <button type="button" data-tab="scenarios">Scenarios</button>
    </nav>

    <!-- Business Analytics Tab (Main Interface) -->
    <section id="business-analytics" class="tab-content">
      <h2>Flexible Business Analytics Tool</h2>
      <p>Analyze any project or business type with tailored input fields and KPIs. Select your business category to get started with relevant analytics for your industry.</p>
      <!-- Dynamic business analytics interface will be generated here -->
    </section>
    
    <!-- Investment Model Tab (Consolidates P&L, ROI, CapEx, OpEx) -->
    <section id="investment-model" class="tab-content hidden">
      <div class="tab-header">
        <h2>Investment Model</h2>
        <div class="tab-actions">
          <button type="button" class="reset-btn icon-reset" onclick="resetInvestmentModel()" title="Reset all investment data">
            Reset
          </button>
          <button type="button" class="export-btn icon-download" onclick="exportInvestmentSummary()" title="Export investment summary">
            Export
          </button>
        </div>
      </div>
      
      <!-- Project Selection Controls -->
      <div class="project-selector-section">
        <div class="project-selector-container">
          <div id="investment-project-selector"></div>
        </div>
      </div>
      
      <div class="sub-tabs">
        <nav class="sub-tab-nav" role="tablist">
          <button type="button" data-subtab="pnl" class="sub-tab active">P&L Statement</button>
          <button type="button" data-subtab="roi" class="sub-tab">ROI Analysis</button>
          <button type="button" data-subtab="capex" class="sub-tab">CapEx Tracking</button>
          <button type="button" data-subtab="summary" class="sub-tab">Investment Summary</button>
        </nav>
        
        <!-- P&L Sub-section -->
        <div id="pnl-section" class="sub-tab-content">
          <div class="section-group">
            <p><em>Combined analysis of all selected project types</em></p>
          </div>
          <div id="pnlSummary" class="summary"></div>
          <div class="section-group">
            <h3>Charts</h3>
            <div class="charts-grid">
              <div class="chart-container"><canvas id="pnlChart" height="180"></canvas></div>
              <div class="chart-container"><canvas id="profitTrendChart" height="180"></canvas></div>
              <div class="chart-container"><canvas id="costPieChart" height="180"></canvas></div>
            </div>
          </div>
          <div id="pnl-collapsible-sections"></div>
        </div>
        
        <!-- ROI Sub-section -->
        <div id="roi-section" class="sub-tab-content hidden">
          <div class="section-group">
            <p><em>ROI analysis for all selected project types</em></p>
            <div class="adjustment-controls">
              <label>Revenue Adjust (%): 
                <input id="roiRevAdjust" type="range" min="0" max="150" value="100" step="1" 
                       oninput="roiRevAdjustLabel.textContent=this.value+'%';updateROI()">
                <span id="roiRevAdjustLabel">100%</span>
              </label>
              <label>Cost Adjust (%): 
                <input id="roiCostAdjust" type="range" min="0" max="200" value="100" step="1" 
                       oninput="roiCostAdjustLabel.textContent=this.value+'%';updateROI()">
                <span id="roiCostAdjustLabel">100%</span>
              </label>
            </div>
          </div>
          <div id="yearsToROIText" class="summary"></div>
          <div id="roiKPIs" class="summary"></div>
          
          <div id="roi-collapsible-sections"></div>
          
          <div id="roi-charts-section"></div>
          
          <div id="roi-sensitivity-section"></div>
        </div>
        
        <!-- CapEx Sub-section -->
        <div id="capex-section" class="sub-tab-content hidden">
          <div class="section-group">
            <h3>Capital Expenditure Tracking</h3>
            <p><em>Track and analyze capital investments across all project types</em></p>
          </div>
          <div id="capexSummary" class="summary"></div>
          <div id="capex-collapsible-sections"></div>
          <div id="capex-charts-section"></div>
        </div>
        
        <!-- Investment Summary Sub-section -->
        <div id="summary-section" class="sub-tab-content hidden">
          <div class="section-group">
            <h3>Investment Summary Report</h3>
            <div class="summary-actions">
              <button onclick="exportPDF()">Export PDF</button>
              <button onclick="exportExcel()">Export Excel</button>
            </div>
          </div>
          <div id="reportContent"></div>
        </div>
      </div>
    </section>
    
    <!-- Staffing & Resourcing Tab -->
    <section id="staffing-resourcing" class="tab-content hidden">
      <div id="staffing-header"></div>
      
      <!-- Project Selection Controls -->
      <div class="project-selector-section">
        <div class="project-selector-container">
          <div id="staffing-project-selector"></div>
        </div>
      </div>
      
      <div class="section-group">
        <h3>Resource Planning & Utilization</h3>
        <p><em>Manage staffing requirements and resource allocation across all project types</em></p>
      </div>
      
      <div id="staffingSummary" class="summary"></div>
      
      <div id="staffing-collapsible-sections"></div>
    </section>
    
    <!-- Execution & Scheduling Tab -->
    <section id="execution-scheduling" class="tab-content hidden">
      <div class="tab-header">
        <h2>Execution & Scheduling</h2>
        <button type="button" class="reset-btn icon-reset" onclick="resetExecutionScheduling()" title="Reset scheduling data">
          Reset
        </button>
      </div>
      
      <div class="sub-tabs">
        <nav class="sub-tab-nav" role="tablist">
          <button type="button" data-subtab="gantt" class="sub-tab active">Project Timeline</button>
          <button type="button" data-subtab="milestones" class="sub-tab">Milestones</button>
          <button type="button" data-subtab="approvals" class="sub-tab">Approvals & Payback</button>
        </nav>
        
        <!-- Gantt Chart Sub-section -->
        <div id="gantt-section" class="sub-tab-content">
          <div class="section-group">
            <h3>Project Timeline (Gantt Chart)</h3>
            <div id="ganttViewModes">
              <button type="button" onclick="setGanttViewMode('Day')">Day</button>
              <button type="button" onclick="setGanttViewMode('Week')">Week</button>
              <button type="button" onclick="setGanttViewMode('Month')">Month</button>
              <button type="button" onclick="setGanttViewMode('Year')">Year</button>
              <button type="button" id="exportGanttCSVBtn" onclick="exportGanttCSV()">Export CSV</button>
            </div>
          </div>
          
          <div class="collapsible-section">
            <button type="button" class="collapsible-toggle" aria-expanded="true" aria-controls="taskManagementSection">
              Task Management
            </button>
            <div class="collapsible-content" id="taskManagementSection">
              <form id="ganttTaskForm">
                <input id="ganttEditId" type="hidden">
                <div class="form-grid">
                  <label>Task Name: <input id="ganttTaskName" type="text" required></label>
                  <label>Start: <input id="ganttTaskStart" type="date" required></label>
                  <label>End: <input id="ganttTaskEnd" type="date" required></label>
                  <label>Progress (%): <input id="ganttTaskProgress" type="number" min="0" max="100" value="0"></label>
                </div>
                <div class="form-actions">
                  <button type="submit">Save Task</button>
                  <button type="button" id="ganttTaskResetBtn">Reset Form</button>
                </div>
              </form>
              <div id="ganttTaskList"></div>
            </div>
          </div>
          
          <div id="ganttContainer" style="margin-top:1rem"></div>
        </div>
        
        <!-- Milestones Sub-section -->
        <div id="milestones-section" class="sub-tab-content hidden">
          <div class="section-group">
            <h3>Project Milestones</h3>
            <p><em>Track key project milestones and deliverables</em></p>
          </div>
          
          <div class="milestone-manager">
            <form id="milestoneForm">
              <div class="form-grid">
                <label>Milestone Name: <input id="milestoneName" type="text" required></label>
                <label>Target Date: <input id="milestoneDate" type="date" required></label>
                <label>Status: 
                  <select id="milestoneStatus">
                    <option value="pending">Pending</option>
                    <option value="in-progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="delayed">Delayed</option>
                  </select>
                </label>
                <label>Priority: 
                  <select id="milestonePriority">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="critical">Critical</option>
                  </select>
                </label>
              </div>
              <button type="submit">Add Milestone</button>
            </form>
          </div>
          
          <div id="milestonesList" class="milestones-list"></div>
        </div>
        
        <!-- Approvals & Payback Sub-section -->
        <div id="approvals-section" class="sub-tab-content hidden">
          <div class="section-group">
            <h3>Approvals & Payback Tracking</h3>
            <p><em>Manage project approvals and track payback periods</em></p>
          </div>
          
          <div class="approval-tracker">
            <div class="approval-status">
              <h4>Approval Status</h4>
              <div class="status-grid">
                <div class="status-item">
                  <label>Budget Approval:</label>
                  <select id="budgetApproval">
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div class="status-item">
                  <label>Executive Approval:</label>
                  <select id="executiveApproval">
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div class="status-item">
                  <label>Technical Approval:</label>
                  <select id="technicalApproval">
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
                <div class="status-item">
                  <label>Legal Approval:</label>
                  <select id="legalApproval">
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                  </select>
                </div>
              </div>
            </div>
            
            <div class="payback-tracker">
              <h4>Payback Period Tracking</h4>
              <div id="paybackSummary" class="summary"></div>
              <div class="chart-container">
                <canvas id="paybackProgressChart" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Project Files Tab -->
    <section id="project-files" class="tab-content hidden">
      <div class="tab-header">
        <h2>Project Files & Documentation</h2>
        <button type="button" class="upload-btn icon-upload" onclick="openFileUpload()" title="Upload files">
          Upload Files
        </button>
      </div>
      
      <div class="section-group">
        <h3>Document Management</h3>
        <p><em>Centralized repository for all project documentation and files</em></p>
      </div>
      
      <div class="file-categories">
        <div class="category-tabs">
          <button type="button" data-category="all" class="category-tab active">All Files</button>
          <button type="button" data-category="business-plans" class="category-tab">Business Plans</button>
          <button type="button" data-category="financial" class="category-tab">Financial</button>
          <button type="button" data-category="legal" class="category-tab">Legal</button>
          <button type="button" data-category="technical" class="category-tab">Technical</button>
          <button type="button" data-category="reports" class="category-tab">Reports</button>
        </div>
        
        <div class="file-management-tools">
          <div class="search-files">
            <input type="text" id="fileSearch" placeholder="Search files..." />
            <button onclick="searchFiles()" class="icon-search"></button>
          </div>
          <div class="file-actions">
            <button onclick="window.open('https://aloc23.github.io/pci_project_file_viewer/', '_blank')" class="external-link icon-external">
              Advanced File Viewer
            </button>
          </div>
        </div>
      </div>
      
      <div id="filesList" class="files-list">
        <div class="file-placeholder">
          <p>No files uploaded yet. Click "Upload Files" to get started.</p>
          <p>You can also use the <a href="https://aloc23.github.io/pci_project_file_viewer/" target="_blank">Advanced File Viewer</a> for comprehensive file management.</p>
        </div>
      </div>
      
      <!-- Hidden file upload input -->
      <input type="file" id="fileUploadInput" multiple style="display: none;" onchange="handleFileUpload(event)">
    </section>
    
    <!-- Scenarios Tab (Kept as is) -->
    <section id="scenarios" class="tab-content hidden">
      <h2>Scenarios</h2>
      <form id="scenarioForm">
        <input id="scenarioName" type="text" placeholder="Scenario name" required>
        <button type="submit">Save Scenario</button>
      </form>
      <div id="scenarioList"></div>
      <div id="scenarioDiffContainer" class="section-group"></div>
    </section>

    <!-- Legacy sections kept for backward compatibility (hidden by default) -->
    <section id="project-selector" class="tab-content hidden legacy-section">
      <h2>Project Configuration</h2>
      <p>Select the types of projects you want to analyze. You can choose from predefined templates or create custom project types.</p>
      <!-- Dynamic project type selector will be generated here -->
    </section>
    
    <!-- Padel Tab (Legacy) - Hidden by default, kept for backward compatibility -->
    <section id="padel" class="tab-content hidden legacy-section">
      <h2>Padel Investment &amp; Revenue</h2>
      <div class="section-group">
        <h3>Investment Inputs</h3>
        <label>Ground Cost: <input id="padelGround" type="number" value="50000"></label>
        <label>Structure Cost: <input id="padelStructure" type="number" value="120000"></label>
        <label>Number of Courts: <input id="padelCourts" type="number" value="3"></label>
        <label>Per Court Cost: <input id="padelCourtCost" type="number" value="18000"></label>
        <label>Amenities: <input id="padelAmenities" type="number" value="20000"></label>
      </div>
      <div class="section-group">
        <h3>Utilization Inputs</h3>
        <label>
          Peak Hours/Day:
          <input id="padelPeakHours" type="range" min="0" max="12" value="4" step="0.5" oninput="peakHoursVal.value=this.value; calculatePadel()">
          <input id="peakHoursVal" type="number" min="0" max="12" value="4" step="0.5" oninput="padelPeakHours.value=this.value; calculatePadel()">
        </label>
        <label>
          Peak Utilization (%):
          <input id="padelPeakUtil" type="range" min="0" max="100" value="70" step="1" oninput="peakUtilVal.value=this.value; calculatePadel()">
          <input id="peakUtilVal" type="number" min="0" max="100" value="70" step="1" oninput="padelPeakUtil.value=this.value; calculatePadel()">
        </label>
        <label>
          Peak Rate:
          <input id="padelPeakRate" type="range" min="0" max="100" value="40" step="1" oninput="peakRateVal.value=this.value; calculatePadel()">
          <input id="peakRateVal" type="number" min="0" max="100" value="40" step="1" oninput="padelPeakRate.value=this.value; calculatePadel()">
        </label>
        <label>
          Off Hours/Day:
          <input id="padelOffHours" type="range" min="0" max="12" value="2" step="0.5" oninput="offHoursVal.value=this.value; calculatePadel()">
          <input id="offHoursVal" type="number" min="0" max="12" value="2" step="0.5" oninput="padelOffHours.value=this.value; calculatePadel()">
        </label>
        <label>
          Off Utilization (%):
          <input id="padelOffUtil" type="range" min="0" max="100" value="35" step="1" oninput="offUtilVal.value=this.value; calculatePadel()">
          <input id="offUtilVal" type="number" min="0" max="100" value="35" step="1" oninput="padelOffUtil.value=this.value; calculatePadel()">
        </label>
        <label>
          Off Rate:
          <input id="padelOffRate" type="range" min="0" max="100" value="25" step="1" oninput="offRateVal.value=this.value; calculatePadel()">
          <input id="offRateVal" type="number" min="0" max="100" value="25" step="1" oninput="padelOffRate.value=this.value; calculatePadel()">
        </label>
        <label>Days/Week: <input id="padelDays" type="number" value="7" oninput="calculatePadel()"></label>
        <label>Weeks/Year: <input id="padelWeeks" type="number" value="52" oninput="calculatePadel()"></label>
      </div>
      <div class="section-group">
        <h3>Operating Costs</h3>
        <label>Utilities/year: <input id="padelUtil" type="number" value="5000"></label>
        <label>Insurance/year: <input id="padelInsure" type="number" value="2500"></label>
        <label>Maintenance/year: <input id="padelMaint" type="number" value="3000"></label>
        <label>Marketing/year: <input id="padelMarket" type="number" value="4000"></label>
        <label>Admin/year: <input id="padelAdmin" type="number" value="3500"></label>
        <label>Cleaning/year: <input id="padelClean" type="number" value="2000"></label>
        <label>Misc/year: <input id="padelMisc" type="number" value="1000"></label>
      </div>
      <div class="section-group">
        <h3>Staffing</h3>
        <label>Full-time Manager: <input id="padelFtMgr" type="number" value="1"></label>
        <label>FT Mgr Salary: <input id="padelFtMgrSal" type="number" value="35000"></label>
        <label>Full-time Reception: <input id="padelFtRec" type="number" value="1"></label>
        <label>FT Rec Salary: <input id="padelFtRecSal" type="number" value="21000"></label>
        <label>Full-time Coach: <input id="padelFtCoach" type="number" value="1"></label>
        <label>FT Coach Salary: <input id="padelFtCoachSal" type="number" value="25000"></label>
        <label>Part-time Coach: <input id="padelPtCoach" type="number" value="1"></label>
        <label>PT Coach Salary: <input id="padelPtCoachSal" type="number" value="12000"></label>
        <label>Additional Staff: <input id="padelAddStaff" type="number" value="0"></label>
        <label>Add Staff Salary: <input id="padelAddStaffSal" type="number" value="0"></label>
      </div>
      <div id="padelSummary" class="summary" aria-live="polite"></div>
      <button id="calculatePadelBtn">Calculate Padel</button>
    </section>
    
    <!-- GYM TAB (Legacy) - Hidden by default, kept for backward compatibility -->
    <section id="gym" class="tab-content hidden legacy-section">
      <h2>Gym Investment &amp; Revenue</h2>
      <div class="section-group">
        <h3>Investment Inputs</h3>
        <label>Equipment: <input id="gymEquip" type="number" value="35000"></label>
        <label>Flooring: <input id="gymFloor" type="number" value="8000"></label>
        <label>Amenities: <input id="gymAmen" type="number" value="6000"></label>
      </div>
      <div class="section-group">
        <h3>Revenue Inputs</h3>
        <label>Weekly Members: <input id="gymWeekMembers" type="number" value="60"></label>
        <label>Weekly Fee: <input id="gymWeekFee" type="number" value="20"></label>
        <label>Monthly Members: <input id="gymMonthMembers" type="number" value="30"></label>
        <label>Monthly Fee: <input id="gymMonthFee" type="number" value="50"></label>
        <label>Annual Members: <input id="gymAnnualMembers" type="number" value="12"></label>
        <label>Annual Fee: <input id="gymAnnualFee" type="number" value="450"></label>
      </div>
      <div class="section-group">
        <h3>Operating Costs</h3>
        <label>Utilities/year: <input id="gymUtil" type="number" value="2500"></label>
        <label>Insurance/year: <input id="gymInsure" type="number" value="1700"></label>
        <label>Maintenance/year: <input id="gymMaint" type="number" value="2000"></label>
        <label>Marketing/year: <input id="gymMarket" type="number" value="2500"></label>
        <label>Admin/year: <input id="gymAdmin" type="number" value="2100"></label>
        <label>Cleaning/year: <input id="gymClean" type="number" value="1200"></label>
        <label>Misc/year: <input id="gymMisc" type="number" value="800"></label>
      </div>
      <div class="section-group">
        <h3>Staffing</h3>
        <label>Full-time Trainer: <input id="gymFtTrainer" type="number" value="1"></label>
        <label>FT Trainer Salary: <input id="gymFtTrainerSal" type="number" value="22000"></label>
        <label>Part-time Trainer: <input id="gymPtTrainer" type="number" value="1"></label>
        <label>PT Trainer Salary: <input id="gymPtTrainerSal" type="number" value="9000"></label>
        <label>Additional Staff: <input id="gymAddStaff" type="number" value="0"></label>
        <label>Add Staff Salary: <input id="gymAddStaffSal" type="number" value="0"></label>
      </div>
      <div class="section-group">
        <h3>Ramp-up</h3>
        <label>Apply Ramp-Up? <input id="gymRamp" type="checkbox"></label>
        <label>Ramp Duration (months): <input id="rampDuration" type="range" min="0" max="12" value="3" step="1" oninput="rampDurationLabel.textContent=this.value"><span id="rampDurationLabel">3</span></label>
        <label>Ramp Effect (%): <input id="rampEffect" type="range" min="0" max="100" value="40" step="1" oninput="rampEffectLabel.textContent=this.value+'%'"><span id="rampEffectLabel">40%</span></label>
      </div>
      <div id="gymSummary" class="summary" aria-live="polite"></div>
      <button id="calculateGymBtn">Calculate Gym</button>
    </section>
  </main>
</body>
</html>
